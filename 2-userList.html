<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>userList</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table{
            margin-top: 10px;
        }
    </style>
  </head>

  <body>
    <div class="container">
        <div class="page-header">
            <h1>用户列表</h1>
        </div>
        <div class="text-right">
            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#exampleModal">添加用户</button>
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">添加用户</h4>
                </div>
                <div class="modal-body">
                    <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">姓名:</label>
                        <input type="text" class="form-control" id="recipient-name">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">性别:</label>
                        <input type="text" class="form-control" id="recipient-name">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">年龄:</label>
                        <input type="text" class="form-control" id="recipient-name">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">电话:</label>
                        <input type="text" class="form-control" id="recipient-name">
                    </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary">提交</button>
                </div>
                </div>
            </div>
        </div>
        <table class="table table-bordered">
            <tbody>
                <tr>
                    <th>编号</th>
                    <th>姓名</th>
                    <th>性别</th>
                    <th>年龄</th>
                    <th>电话</th>
                    <th>操作</th>
                </tr>
                <!-- <tr>
                    <td>1</td>
                    <td>张三</td>
                    <td>男</td>
                    <td>26</td>
                    <td>18878789898</td>
                    <td>
                        <button type="button" class="btn btn-success btn-xs" data-toggle="modal" data-target="#editModal"><span class="glyphicon glyphicon-pencil"></span> 编辑</button>
                        <button type="button" class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove"></span> 删除</button>
                    </td>
                </tr> -->
            </tbody>
        </table>
        
        <nav aria-label="Page navigation" class="text-right">
            <ul class="pagination">
                <li class="prev">
                    <a href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <!-- <li><a href="#">1</a></li> -->
                <li class="next">
                    <a href="#" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>

        <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="exampleModalLabel">编辑用户</h4>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="form-group">
                          <label for="recipient-name" class="control-label">姓名:</label>
                          <input type="text" class="form-control editName" id="recipient-name">
                        </div>
                        <div class="form-group">
                            <label for="recipient-name" class="control-label">性别:</label>
                            <input type="text" class="form-control editSex" id="recipient-name">
                          </div>
                          <div class="form-group">
                            <label for="recipient-name" class="control-label">年龄:</label>
                            <input type="text" class="form-control editAge" id="recipient-name">
                          </div>
                          <div class="form-group">
                            <label for="recipient-name" class="control-label">电话:</label>
                            <input type="text" class="form-control editPhone" id="recipient-name">
                          </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      <button type="button" class="btn btn-primary editSubmit editSubmit">提交</button>
                    </div>
                  </div>
                </div>
            </div>

    </div>


    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

    <script>
        //加载首页页面数据
        $.ajax({
            url: '../userList.php',
            type: 'get',
            data: {
                type: 'page',
                page:1,
            },
            dataType: 'json',
            success: function(json){
                //分页判断
                var pages = Math.ceil(json.total/8);
                var newNode = '';
                for(var i=0; i<pages; i++) {
                    newNode += `<li class="num"><a href="#">${i+1}</a></li>`;
                }
                $('.pagination li').eq(0).after(newNode);

                $('.num').eq(0).addClass('active');

                $.each(json.data,function(index,item){
                    $('.table tbody').append(`<tr>
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.sex}</td>
                        <td>${item.age}</td>
                        <td>${item.phone}</td>
                        <td>
                            <button type="button" class="btn btn-success btn-xs" data-toggle="modal" data-target="#editModal"><span class="glyphicon glyphicon-pencil"></span> 编辑</button>
                            <button type="button" class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove"></span> 删除</button>
                        </td>
                    </tr>`);
                })
            }
        });
        // 编辑用户
        var userId1;
        $('.table').on('click','.btn-success',function (){
            userId1 = $(this).closest('tr').find('td').eq(0).text();
            var name = $(this).closest('tr').find('td').eq(1).text();
            var sex = $(this).closest('tr').find('td').eq(2).text();
            var age = $(this).closest('tr').find('td').eq(3).text();
            var phone = $(this).closest('tr').find('td').eq(4).text();
            $('.editName').val(name);
            $('.editSex').val(sex);
            $('.editAge').val(age);
            $('.editPhone').val(phone);
        })
        //提交
        $('.editSubmit').click(function(){
            $.ajax({
                url: '../userList.php',
                type: 'get',
                data: {
                    type: 'update',
                    name: $('.editName').val(),
                    sex: $('.editSex').val(),
                    age: $('.editAge').val(),
                    phone: $('.editPhone').val(),
                    userId: userId1,
                }, 
                dataType: 'json',
                success: function(data) {
                    $('#editModal').modal('hide');
                    location.reload();
                }
            });
        });
        
        var index = 0;
        //上一页
        $('.prev').click(function(){
            index--;
            if(index<=0){
                index=0;
            }
            $('.num').eq(index).addClass('active').next().removeClass('active');
            //刷新页面数据
            loadData(index);
        });

        //下一页
        $('.next').click(function(){
            index++;
            if(index>=$('.num').length){
                index = $('.num').length-1;
            }
            $('.num').eq(index).addClass('active').prev().removeClass('active');
            //刷新页面数据
            loadData(index);
        });
        //刷新页面数据
        function loadData(index) {
            $.ajax({
                url: '../userList.php',
                type: 'get',
                data: {
                    type: 'page',
                    page: index+1,
                }, 
                dataType: 'json',
                success: function(json) {
                    //删除之前节点数据
                    $('.table tbody').html('');
                    $('.table tbody').append(`<tr>
                        <th>编号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>年龄</th>
                        <th>电话</th>
                        <th>操作</th>
                    </tr>`);
                    //刷新数据
                    $.each(json.data,function(index,item){
                        $('.table tbody').append(`<tr>
                            <td>${item.id}</td>
                            <td>${item.name}</td>
                            <td>${item.sex}</td>
                            <td>${item.age}</td>
                            <td>${item.phone}</td>
                            <td>
                                <button type="button" class="btn btn-success btn-xs" data-toggle="modal" data-target="#editModal"><span class="glyphicon glyphicon-pencil"></span> 编辑</button>
                                <button type="button" class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove"></span> 删除</button>
                            </td>
                        </tr>`);
                    })
                }
            });
        }

        //删除
        $('.table').on('click','.btn-danger',function (){
            //传入 ID ,数据库选中ID删除
            var userId1 = $(this).closest('tr').find('td').eq(0).text();
            $ajax({
                url: '../userList.php',
                type: 'get',
                data: {
                    type: 'delete',
                    userId: userId1,
                },
                dataType: 'json',
                success: function(d){
                    console.log(d);
                }
            });
        })
    </script>
  </body>
</html>